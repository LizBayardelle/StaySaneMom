<!-- page-specific content -->
  <% title @blog.title %>
  <%= content_for :head do %>
    <meta name="description" content="<%= @blog.teaser %>" />
    <meta property="og:url" content="<%= polymorphic_url(@blog) %>" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="<%= @blog.title %>" />
    <meta property="og:description" content="
      <% if @blog.data_pin_description != "" || !@blog.data_pin_description %>
        <%= @blog.data_pin_description %>
      <% else %>
        <%= @blog.teaser %>
      <% end %>" />
    <meta property="og:image" content="<%= rails_blob_url(@blog.image) if @blog.image.attached? %>" />
    <% if @blog.published_on %><meta property="article:published_time" content="<%= @blog.published_on.strftime('%FT%T') %>" /><% end %>
    <meta property="article:author" content="<%= @blog.user.first_name %> <%= @blog.user.last_name %>" />
  <% end %>
<!-- page-specific content -->

<!-- Exit intent -->
<script async data-uid="cd10cef13b" src="https://f.convertkit.com/cd10cef13b/f2d65b6d27.js"></script>
<!-- Exit intent -->

<!-- Load Facebook SDK for JavaScript -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<!-- facebook share -->

<div class="header-frame frame" style="background-image: url(<%= rails_blob_url(@blog.image) if @blog.image.attached? %>)">
  <% case @blog.category %>
  <% when "House" %>
    <div class="image-overlay-white"><div class="inner-frame border-house"></div></div>
  <% when "Spouse" %>
    <div class="image-overlay-white"><div class="inner-frame border-spouse"></div></div>
  <% when "Kids" %>
    <div class="image-overlay-white"><div class="inner-frame border-kids"></div></div>
  <% when "Self" %>
    <div class="image-overlay-white"><div class="inner-frame border-self"></div></div>
  <% else %>
    <div class="image-overlay-white"><div class="inner-frame border-neutral"></div></div>
  <% end %>
</div>
<div class="over-frame-text blog-show-header <%= @blog.category %>">
  <div class="container">
    <h1><%= @blog.title %></h1>
  </div> <!-- container -->
</div> <!-- over-frame-text -->


<% case @blog.category %>
<% when "House" %>
  <div class="blog-show house">
<% when "Spouse" %>
  <div class="blog-show spouse">
<% when "Kids" %>
  <div class="blog-show kids">
<% when "Self" %>
  <div class="blog-show self">
<% else %>
  <div class="blog-show neutral">
<% end %>
  <div class="container">
    <% if current_user && current_user.admin %>
      <div class="text-right">
        <%= link_to "Edit Blog", edit_blog_path(@blog) %>
      </div>
    <% end %>

    <h4 class="text-center"><%= @blog.teaser %></h4>
      <p class="text-center">
        <strong>Written by <%= link_to user_path(@blog.user) do %>
          <%= @blog.user.first_name %> <%= @blog.user.last_name %>
        <% end %>
        &nbsp; | &nbsp;
        <% if @blog.user.admin %>
          <i class="fas fa-glasses color-spouse"></i> &nbsp;Stay Sane Mom Founder
        <% elsif @blog.user.contributor %>
          <i class="fas fa-keyboard color-spouse"></i> &nbsp;Stay Sane Mom Contributor
        <% end %></strong><br />
        <% if @blog.published_on %>Published <% if @subcategory %>in <span class="color-spouse boldest"><%= @blog.category %></span>, <span class="color-spouse boldest"><%= @subcategory.name %></span><% end %> on <%= @blog.published_on.in_time_zone("America/Los_Angeles").strftime("%B %d, %Y")  %><br /><% end %>
      </p>
  </div> <!-- container -->

<% if @blog.published != false %>

<!-- Social Buttons -->
  <% case @blog.category %>
  <% when "House" %>
    <div class="bg-house">
  <% when "Spouse" %>
    <div class="bg-spouse">
  <% when "Kids" %>
    <div class="bg-kids">
  <% when "Self" %>
    <div class="bg-self">
  <% else %>
    <div class="bg-neutral">
  <% end %>
      <div class="container padded text-center">
        <h2 class="font-script">Care to Share?</h2>
        <div class="fb-share-button"
          data-href="<%= polymorphic_url(@blog) %>"
          data-layout="button_count">
        </div>
        <a href="https://www.pinterest.com/pin/create/button/" data-pin-do="buttonBookmark"></a>
      </div> <!-- text center container -->
    </div> <!-- color stripe -->

<!-- end Social Buttons -->
<% end %> <!-- end skip if unpublished -->



  <div class="half-buffer"></div>

  <% if @blog.video_link != nil && @blog.video_link != "" %>
    <div class="text-center">
      <iframe width="560" height="315" rel=0 src="<%= @blog.video_link %>" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      <div class="half-buffer"></div>
    </div> <!-- centered -->
  <% end %>

  <% if @blog.freebie_type != "None" %>
    <div class="bg-neutral">
      <div class="container text-center">

        <div class="half-buffer"></div>

        <h4 class="text-center">Want to cut to the chase?</h4>
        <h2 class="text-center"><%= @blog.cta_pdf %> Now</h2>
        <% if current_user %>
          <% if @blog.freebie_type == "File" %>
            <%= link_to asset_path(@blog.freebie_filename, skip_pipeline: true), target: "_blank", class: "btn btn-outline-danger font-bold" do %><%= @blog.freebie_description %><% end %>
          <% else %>
            <a href="<%= @blog.freebie_filename %>" target="_blank" class="btn btn-outline-danger font-bold"><%= @blog.freebie_description %></a>
          <% end %>
        <% else %>
          <a href="<%= @blog.convertkit_href %>" class="btn btn-outline-danger font-bold cta-top">Download Now</a>
          <p><br />Or <%= link_to "log in", new_user_session_path %> for direct access to this and the rest of our <%= link_to "resource library", static_path(:resources) %>.</p>
        <% end %>

        <div class="half-buffer"></div>

      </div> <!-- container -->
    </div> <!-- bg row -->
  <% end %>


  <div class="container">
    <div class="half-buffer"></div>

    <div class="blog-itself col-xs-12">
      <% if @blog.affiliate_links %>
        <p class="text-center"><em>Some of the links below are affiliate links, which means I earn a small fee from any qualifying purchases you make.  I only recommend products I wholeheartedly love and support.</em></p>
      <% end %>
      <%= raw(@blog.body) %>
    </div>

  </div> <!-- container -->

  <!-- related posts -->
  <div class="container">
    <h2>Related Posts</h2>
    <ul>
      <% @related = Blog.where(subcategory_id: @blog.subcategory_id, published: true, ).where("published_on <= ?", Date.today).order("comments_count DESC") %>
      <% @related.each do |blog| %>
        <li><%= link_to blog.title, blog_path(blog), class: "color-spouse boldest" %></li>
      <% end %>
    </ul>
  </div>
  <!-- related posts -->

<!-- admin links -->
  <% if (current_user && current_user.admin) || (current_user && current_user == @blog.user) %>
  <div class="text-center">
    <div class="half-buffer"></div>
    <%= link_to 'Edit', edit_blog_path(@blog) %> |
    <%= link_to 'Back', blogs_path %>
  </div>
  <% end %>
<!-- end admin links -->


<!-- freebie -->
  <% if @blog.freebie_type != "None" %>
    <div class="half-buffer"></div>
    <div class="bg-neutral">
      <div class="container text-center">

        <div class="half-buffer"></div>

        <h4 class="text-center">Start Your Next Step</h4>
        <h2 class="text-center"><%= @blog.cta_pdf %> Now</h2>
        <% if current_user %>
        <% if @blog.freebie_type == "File" %>
        <%= link_to asset_path(@blog.freebie_filename, skip_pipeline: true), target: "_blank", class: "btn btn-outline-danger font-bold" do %><%= @blog.freebie_description %><% end %>
        <% else %>
        <a href="<%= @blog.freebie_filename %>" target="_blank" class="btn btn-outline-danger font-bold"><%= @blog.freebie_description %></a>
        <% end %>
        <% else %>
        <a href="<%= @blog.convertkit_href %>" class="btn btn-outline-danger font-bold cta-bottom">Download Now</a>
        <p><br />Or <%= link_to "log in", new_user_session_path %> for direct access to this and the rest of our <%= link_to "resource library", static_path(:resources) %>.</p>
        <% end %>

        <div class="half-buffer"></div>

      </div> <!-- container -->
    </div> <!-- bg row -->
    <% end %>
<!-- end freebie -->

<div class="half-buffer"></div>

<!-- sharing links -->
  <div class="container padded text-center">
    <h2 class="font-script">Care to Share?</h2>
    <div class="fb-share-button"
      data-href="<%= polymorphic_url(@blog) %>"
      data-layout="button_count">
    </div>
    <a href="https://www.pinterest.com/pin/create/button/" data-pin-do="buttonBookmark"></a>

    <% if @blog.pin_image.attached? %>
      <div class="pinterest-image row padded pin-image-stripe">
        <div class="container">
          <% @blog.pin_image.each do |image| %>
            <%= image_tag url_for(image)%>
          <% end %>
        </div>
      </div>
    <% end %>
  </div> <!-- text center container -->
<!-- end sharing links -->



    <div class="half-buffer"></div>

    <% case @blog.category %>
    <% when "House" %>
      <div class="bg-house">
    <% when "Spouse" %>
      <div class="bg-spouse">
    <% when "Kids" %>
      <div class="bg-kids">
    <% when "Self" %>
      <div class="bg-self">
    <% else %>
      <div class="bg-neutral">
    <% end %>
        <div class="container">
          <div class="half-buffer"></div>
          <div class="text-center">
            <h2>Get Sanity, Delivered to Your Inbox.</h2>
            <div class="click-simulator"><script async data-uid="229e74784f" src="https://f.convertkit.com/229e74784f/ac0fba8d30.js"></script></div>
          </div>
          <div class="half-buffer"></div>
        </div> <!-- container -->
      </div> <!-- bg row -->

<% if @blog.published != false %>

  <div class="container"> <!-- comments container -->
    <div class="new-comment">
      <%= simple_form_for [@blog, Comment.new] do |f| %>
        <%= f.error_notification %>

        <div class="half-buffer"></div>
        <h2 class="text-center font-script">Give Your Two Cents!</h2>

        <div class="form-inputs col-xs-12" style="margin-bottom: 10px">
          <%= f.text_area :body, class: "form-control", placeholder: "Add a comment", required: true %>
        </div>

        <% if @comment_user %>
          <%= f.hidden_field :name, value: [@comment_user.first_name, @comment_user.last_name].join(' ') %>
          <%= f.hidden_field :email, value: @comment_user.email %>
        <% else %>
          <div class="row">
            <div class="form-inputs col-sm-6">
              <%= f.label "Your Name" %>
              <%= f.text_field :name, class: "form-control", required: true, placeholder: "e.g. Warren Buffett" %>
            </div>
            <div class="form-inputs col-sm-6">
              <%= f.label "Your Email (Not Displayed)" %>
              <%= f.text_field :email, class: "form-control", required: true, placeholder: "e.g. wbuffett@gmail.com" %>
            </div>
          </div> <!-- row -->
        <% end %>
        <% if !current_user %>
          <p style="margin-top: 15px">To display a link to your website along with your comment, <%= link_to "create an account", new_user_registration_path %> or <%= link_to "log in", new_user_session_path %>.</p>
        <% end %>

        <div class="form-actions text-right">
          <div class="half-buffer"></div>
          <%= f.button :submit, "Submit Comment", class: "btn btn-outline-danger submit-comment" %>
        </div>
      <% end %>
    </div>

    <h2 class="color-neutral"><%= pluralize(@comments.count, "Comment") %></h2>
    <% @comments.each do |comment| %>
        <div class="row">
          <div class="col-1 text-right" style="padding: 0">
            <% if comment.user && comment.user.avatar.attached? %>
              <%= image_tag rails_blob_url(comment.user.avatar), class: "img-fluid z-depth-1 rounded-circle", style: "width: 70px; height: 70px; object-fit: cover; margin-bottom: 10px" %>
            <% else %>
              <%= image_tag "missing_avatar.jpg", class: "img-fluid z-depth-1 rounded-circle", style: "width: 70px; height: 70px; object-fit: cover; margin-bottom: 10px" %>
            <% end %>
          </div> <!-- img col -->
          <div class="col-11">
            <h5 class="comment-byline" style="text-transform: capitalize; margin-bottom: 0px"><%= comment.name %> on <%= comment.created_at.strftime("%b %d, %Y") %></h5>
            <p style="width: 100%; margin-bottom: 0px">
              <span><%= comment.body %></span>
              <% if current_user && current_user.admin %>
                <%= link_to blog_comment_path(@blog, comment), method: :delete, data: {confirm: "Are you sure you want to delete that comment?"} do %>
                  <%= fa_icon "trash", class: "color-neutral color-neutral-hover" %>
                <% end %><br />
              <% end %>
            </p>
            <% if comment.user %>
              <p style="width: 100%; margin-bottom: 0px"><em><small>
                <% if comment.user.website_url && comment.user.website_name %>
                  From <%= link_to comment.user.website_url do %><%= comment.user.website_name %><% end %>
                <% end %>
                <% if comment.user.contributor && comment.user.id != 1 %>
                  &nbsp;&nbsp </em>|<em> &nbsp;&nbsp<i class="fas fa-keyboard color-spouse"></i> &nbsp;Stay Sane Mom Contributor
                <% end %>
                <% if comment.user.id == 1 %>
                  &nbsp;&nbsp </em>|<em> &nbsp;&nbsp<i class="fas fa-glasses color-spouse"></i> &nbsp;Stay Sane Mom Founder
                <% end %>
              </small></em></p>
            <% end %>

            <p class="color-self font-bold" id="replyCommentTarget<%= comment.id %>">Reply <i class="fas fa-reply"></i></p>

            <% @responses = Response.where(comment_id: comment.id) %>
            <% @responses.each do |response| %>
              <div class="row">
                <div class="col-1 text-right" style="padding: 0">
                  <% if response.user && response.user.avatar.attached? %>
                    <%= image_tag rails_blob_url(response.user.avatar), class: "img-fluid z-depth-1 rounded-circle", style: "width: 70px; height: 70px; object-fit: cover; margin-bottom: 20px" %>
                  <% else %>
                    <%= image_tag "missing_avatar.jpg", class: "img-fluid z-depth-1 rounded-circle", style: "width: 70px; height: 70px; object-fit: cover; margin-bottom: 10px" %>
                  <% end %>
                </div> <!-- img col -->
                <div class="col-11">
                  <h5 class="comment-byline" style="text-transform: capitalize; margin-bottom: 0px"><%= response.name %> on <%= response.created_at.strftime("%b %d, %Y") %></h5>
                  <p style="width: 100%; margin-bottom: 0px">
                    <span><%= response.body %></span>
                    <% if current_user && current_user.admin %>
                      <%= link_to comment_response_path(comment, response), method: :delete, data: {confirm: "Are you sure you want to delete that response?"} do %>
                        <%= fa_icon "trash", class: "color-neutral color-neutral-hover" %>
                      <% end %><br />
                    <% end %>
                  </p>
                  <% if response.user %>
                    <p style="width: 100%; margin-bottom: 0px"><em><small>
                      <% if response.user.website_url && response.user.website_name %>
                        From <%= link_to response.user.website_url do %><%= response.user.website_name %><% end %>
                      <% end %>
                      <% if response.user.contributor && response.user.id != 1 %>
                        &nbsp;&nbsp </em>|<em> &nbsp;&nbsp<i class="fas fa-keyboard color-spouse"></i> &nbsp;Stay Sane Mom Contributor
                      <% end %>
                      <% if response.user.id == 1 %>
                        &nbsp;&nbsp </em>|<em> &nbsp;&nbsp<i class="fas fa-glasses color-spouse"></i> &nbsp;Stay Sane Mom Founder
                      <% end %>
                    </small></em></p>
                  <% end %>
                </div> <!-- img col -->
              </div> <!-- row -->
            <% end %> <!-- comment each response show -->

            <div class="new-response d-none" id="replyCommentField<%= comment.id %>">
              <%= simple_form_for [comment, Response.new] do |f| %>
                <%= f.error_notification %>

                <div class="form-inputs col-xs-12" style="margin-bottom: 10px">
                  <%= f.text_area :body, class: "form-control", placeholder: "Reply to comment", required: true %>
                </div>

                <% if @comment_user %>
                  <%= f.hidden_field :name, value: [@comment_user.first_name, @comment_user.last_name].join(' ') %>
                  <%= f.hidden_field :email, value: @comment_user.email %>
                <% else %>
                  <div class="row">
                    <div class="form-inputs col-sm-6">
                      <%= f.label "Your Name" %>
                      <%= f.text_field :name, class: "form-control", required: true, placeholder: "e.g. Warren Buffett" %>
                    </div>
                    <div class="form-inputs col-sm-6">
                      <%= f.label "Your Email (Not Displayed)" %>
                      <%= f.text_field :email, class: "form-control", required: true, placeholder: "e.g. wbuffett@gmail.com" %>
                    </div>
                  </div> <!-- row -->
                <% end %>
                <% if !current_user %>
                  <p style="margin-top: 15px">To display a link to your website along with your response, <%= link_to "create an account", new_user_registration_path %> or <%= link_to "log in", new_user_session_path %>.</p>
                <% end %>

                <div class="form-actions text-right">
                  <div class="half-buffer"></div>
                  <%= f.button :submit, "Reply", class: "btn btn-outline-danger submit-comment" %>
                </div>
              <% end %>
            </div>

            <script>
              $(document).ready(function() {
                $('#replyCommentTarget<%= comment.id %>').click(function() {
                  $('#replyCommentField<%= comment.id %>').toggleClass('d-none');
                });
              });
            </script>

          </div> <!-- img col -->
        </div> <!-- row -->
    <% end %> <!-- comment each -->
<% end %> <!-- end skip if unpublished -->

    <div class="buffer"></div>

    </div> <!-- page container -->
      <%= render partial: "layouts/biobox", locals: { user: @blog.user, header: "About the Author" } %>

</div> <!-- row -->

<%= content_for :additional_js do %>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.cta-top').click(function() {
        ga('send', 'event', 'Subscription', 'Blog Freebie CTA Beginning', '<%= @blog.title %> Freebie CTA Beginning');
      });
      $('.click-simulator').click(function() {
          ga('send', 'event', 'Subscription', 'In-Page Subscription', '<%= @blog.title %> Subscription Box');
      });
      $('.cta-bottom').click(function() {
        ga('send', 'event', 'Subscription', 'Blog Freebie CTA End', '<%= @blog.title %> Freebie CTA End');
      });
      $('.submit-comment').click(function() {
          ga('send', 'event', 'Participation', 'Blog Comment', '<%= @blog.title %> Comment');
      });
      $('#replyCommentTarget').click(function() {
        $(#reply)
      });
    });
  </script>
<% end %>
