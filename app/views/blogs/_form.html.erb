<%= simple_form_for(@blog) do |f| %>

<div class="container"> <!-- header -->
  <p class="text-center">Editing as
    <% if current_user.admin %>Admin<% elsif current_user.contributor %>Contributor<% end %>
  </p>
  <%= f.error_notification %>
  <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>
</div> <!-- header container -->






<div class="container">
  <div class="half-buffer"></div>
  <h2 class="text-center">Basic Blog Info</h2>
  <div class="form-inputs">
    <div class="form-group">
      <h5>Blog Title</h5>
      <%= f.text_field :title, class: "form-control" %>
    </div>
    <div class="form-group">
      <h5>One-Sentence Teaser</h5>
      <%= f.text_area :teaser, class: "form-control" %>
    </div>

    <div class="row">
      <div class="col-sm-6">
        <% if current_user && current_user.admin %>
          <h5>Blog Placement</h5>
          <div class="form-group">
            <%= f.input :pillar, label: "Pillar Content" %>
            <%= f.input :featured_home, label: "Feature on Homepage" %>
            <%= f.input :featured_category, label: "Feature on Category Page" %>
          </div> <!-- form group -->
        <% end %>
      </div> <!-- col -->

      <div class="col-sm-6">
        <% if current_user && current_user.admin %>
          <div class="form-group">
            <h5>Author</h5>
            <% possible_users = User.where(contributor: true).or(User.where(admin: true)) %>
            <%= f.input :user_id, collection: possible_users, label_method: lambda { |user| "#{user.first_name} #{user.last_name}" }, value_method: :id, optional: true, label: false, include_blank: false, selected: @blog.user_id, input_html: {class: 'browser-default'} %>
          </div>
        <% else %>
          <%= f.hidden_field :user_id, value: current_user.id %>
        <% end %>
      </div> <!-- col -->
    </div> <!-- row -->


    <div class="row">
      <div class="col-sm-6 form-group form-check jsItUp" >
        <h5>Categories</h5>
        <div style="margin-left: 20px">
          <%= f.collection_check_boxes(:category_ids, Category.all, :id, :name ) %>
        </div>
       </div>

      <div class="col-sm-6 form-group">
        <h5>Subcategory</h5>
        <%= f.input :subcategory_id, collection: @subcategories, label_method: lambda { |sub| "#{sub.name}" }, value_method: :id, optional: true, label: false, include_blank: false, selected: @blog.subcategory_id, input_html: {class: 'browser-default'} %>
      </div>
    </div> <!-- row -->

  </div> <!-- form inupts -->
</div> <!-- container -->




  







<% if current_user.admin %>
  <div class="container">
    <div class="form-inputs">
      <div class="half-buffer"></div>
      <h2 class="text-center">Images</h2>

      <div class="row">
        <div class="col-sm-6 form-group">
          <%= f.label "External Photo URL" %>
          <%= f.text_field :photo_url, class: "form-control mb-2" %>
          <%= f.hidden_field :photo_external, value: true %>
        </div>
        <div class="col-sm-6 form-group">
          <%= f.label "Pinterest Images" %><br />
          <%= f.file_field :pin_image, multiple: true %>
        </div>
      </div> <!-- row -->

        <div class="row">
          <div class="col-12 form-group">
            <%= f.label "Pinterest Description" %>
            <%= f.text_area :data_pin_description, class: "form-control" %>
          </div>
        </div> <!-- row -->

        <% freebie_collection = [] %>
        <% Freebie.where(active: true).each do |freebie| %>
          <% freebie_collection << ["#{freebie.name}", "#{freebie.id}"] %>
        <% end %>

        <div class="row">
          <div class="col-sm-6 form-group">
            <%= f.label "Lead Magnet" %>
            <%= f.input :freebie_id, label: false, prompt: "Choose a Related Goody", input_html: { class: 'browser-default' }, collection: freebie_collection, required: false %>
          </div>
          <div class="col-sm-6 form-inputs">
            <%= f.label "Video Link" %>
            <%= f.text_field :video_link, class: "form-control" %>
          </div> <!-- form inputs -->
        </div> <!-- row -->

    </div> <!-- form inputs -->
  </div> <!-- basic blog info container -->




  



<% end %> <!-- end admin only images section -->



<div class="container">
  <div class="half-buffer"></div>
  <h2 class="text-center">Blog Details</h2>

  <div class="form-inputs">
    <div class="form-group">
      <h5>Contributor Actions</h5>
      <% if @blog.submitted %>
        <p>This blog has already been submitted as a final draft.  Please contact an admin if you need to make any changes.</p>
      <% else %>
        <%= f.input :submitted, label: "Submit Blog as Final Draft (Cannot be Undone without Admin Assistance)" %>
      <% end %>
      <% if current_user.admin %>
        <div class="form-group">
          <%= f.input :approved, label: "Approved by Admin" %>
        </div> <!-- form group -->
      <% end %>
    </div> <!-- form group -->

    <% if current_user.admin %>
      <h5>Admin Actions</h5>
      <div class="row">
        <div class="col-sm-6 form-group">
          <%= f.input :published %>
          <%= f.input :nondisplayed %>
        </div> <!-- form group -->
        <div class="col-sm-6 form-group">
          <input placeholder="Published on Date" type="text" id="date" class="form-control datepicker"></input>
          <%= f.hidden_field :published_on, id: "dateHolder", class: "hiddenDateField" %>
        </div> <!-- form group -->
      </div> <!-- row -->

      <div class="form-group">
        <h5>Affiliate Links</h5>
        <%= f.input :affiliate_links, label: "This blog contains affiliate links." %>
      </div> <!-- form group -->
    <% end %>


  </div> <!-- form inputs -->
</div> <!-- basic blog info container -->












<div class="container">
  <div class="half-buffer"></div>
  <h2 class="text-center">The Blog Itself</h2>

  <div class="form-inputs">
    <div class="col-12 my-4 tinymce">
      <%= f.text_area :body, class: "tinymce", rows: 20, style: "width: 100%" %>
    </div>

  </div> <!-- form inputs -->
</div> <!-- basic blog info container -->











<div class="container">
  <div class="half-buffer"></div>

  <div class="form-actions text-center narrow">
    <p>
      Unless you checked the "Submit Blog as Final Draft" checkbox, this will be saved as a <strong>draft</strong>. You can find and edit it at any time from <%= link_to "My Account", user_path(current_user) %> if&nbsp;you&nbsp;want&nbsp;to&nbsp;make&nbsp;changes.
    </p>
    <%= f.button :submit, class: "btn btn-neutral" %>
  </div>
</div> <!-- container -->

<% end %>


<%= content_for :additional_js_partial do %>
<%= tinymce_assets %>
<%= tinymce plugins: ["wordcount", "code", "anchor", "casechange", "codesample", "hr", "link", "preview"] %>

  <script type="text/javascript">
    $(document).ready(function() {
      $(".jsItUp input").addClass("form-check-input");
      $(".jsItUp label").addClass("form-check-label");
      $('.datepicker').pickadate();
      $('#date').on('change', function() {
        var date = $('#date').val();
        $('#dateHolder').val(date);
      });
    });
  </script>
<% end %>
