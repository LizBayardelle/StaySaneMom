<main class="container-fluid px-5 pb-5 pt-0">

  <header class="text-center">
    <h1>Lead Magnets</h1>
    <%= link_to 'Create a New Resource', new_resource_path, class: "btn btn-outline-danger" %>
  </header>

  <section>
    <div class="table-responsive" style="width: 100%">
      <table id="dtBasicExample" class="table" width="100%">
        <thead>
          <tr>
            <th class="th-sm" scope="col">Image</th>
            <th class="th-sm" scope="col">Resource</th>
            <th class="th-sm" scope="col">Category</th>
            <th class="th-sm" scope="col">Blogs</th>
            <th class="th-sm" scope="col">Format</th>
            <th class="th-sm" scope="col">Active</th>
            <th class="th-sm" scope="col" colspan="2"></th>
          </tr>
        </thead>

        <tbody>
          <% @resources.each do |resource| %>
            <tr>
              <td>
                <%= link_to resource do %>
                  <img src="<%= rails_blob_path(resource.sample) %>" class="z-depth-3" style="max-height: 40px">
                <% end %>
              </td>
              <td>
                <% if resource.house %>
                  <% category = "house" %>
                <% elsif resource.spouse %>
                  <% category = "spouse" %>
                <% elsif resource.kids %>
                  <% category = "kids" %>
                <% elsif resource.self %>
                  <% category = "self" %>
                <% end %>
                <%= link_to resource.title, resource_path(resource), class: "color-#{category}" %>
                <br><%= resource.freebie_type %> by <%= resource.user.full_name %>
              </td>
              <td>
                <%= link_to category.capitalize, resource_path(resource), class: "color-#{category}" %>
                <br>
                <% subcategories = [] %>
                <% resource.subcategory_ids.each do |sub| %>
                  <% subcategories << Subcategory.find(sub) %>
                <% end %>
                <%= safe_join(subcategories.map { |l| link_to(l.name, subcategory_path(l.id)) }, ", ".html_safe) %>
              </td>
              <td>
                <% rblogs = Blog.where(id: resource.id) %>
                <%= link_to rblogs.count, "#", class: "color-#{category}", data: { toggle: "modal", target: "#modal-#{resource.id}"} %>

                <div class="modal p-5" id="modal-<%= resource.id %>" tabindex="-1" role="dialog">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-body">
                        <h4>Blogs Using <span class="font-weight-bold"><%= resource.title %></span>:</h4>
                        <ul>
                          <% rblogs.each do |blog| %>
                            <li><%= link_to blog.title, blog, class: "color-#{category}" %></li>
                          <% end %>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

              </td>
              <td><% if !resource.link_instead %>Download<% else %>Link<% end %></td>
              <td><% if resource.active %><i class="fas fa-check"></i><% end %></td>
              <td><%= link_to 'Edit', edit_resource_path(resource) %></td>
              <td><%= link_to 'Delete', resource_path(resource), method: :delete, data: { confirm: 'Are you sure?' } %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </section>

</main>



<%= content_for :additional_js_partial do %>
  <script>
    $(document).ready(function () {
      $('#dtBasicExample').DataTable();
      $('.dataTables_length').addClass('bs-select');
    });
  </script>
<% end %>
